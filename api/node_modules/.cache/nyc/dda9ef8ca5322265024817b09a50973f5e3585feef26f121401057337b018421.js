"use strict";var cov_1o0dc2vijt=function(){var path="C:\\Users\\Olayinka\\ADC\\banka\\api\\dist\\services\\transactions.service.js";var hash="9166238e2bb070357a076a3e7ec3df98ce995e08";var Function=function(){}.constructor;var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Olayinka\\ADC\\banka\\api\\dist\\services\\transactions.service.js",statementMap:{"0":{start:{line:3,column:0},end:{line:5,column:3}},"1":{start:{line:6,column:0},end:{line:6,column:28}},"2":{start:{line:8,column:20},end:{line:8,column:52}},"3":{start:{line:10,column:15},end:{line:10,column:44}},"4":{start:{line:12,column:12},end:{line:12,column:61}},"5":{start:{line:14,column:16},end:{line:14,column:69}},"6":{start:{line:17,column:2},end:{line:19,column:4}},"7":{start:{line:23,column:2},end:{line:25,column:3}},"8":{start:{line:24,column:4},end:{line:24,column:61}},"9":{start:{line:29,column:2},end:{line:35,column:3}},"10":{start:{line:29,column:15},end:{line:29,column:16}},"11":{start:{line:30,column:21},end:{line:30,column:29}},"12":{start:{line:31,column:4},end:{line:31,column:59}},"13":{start:{line:32,column:4},end:{line:32,column:35}},"14":{start:{line:33,column:4},end:{line:33,column:58}},"15":{start:{line:33,column:31},end:{line:33,column:58}},"16":{start:{line:34,column:4},end:{line:34,column:62}},"17":{start:{line:39,column:2},end:{line:39,column:71}},"18":{start:{line:39,column:18},end:{line:39,column:71}},"19":{start:{line:40,column:2},end:{line:40,column:63}},"20":{start:{line:40,column:19},end:{line:40,column:63}},"21":{start:{line:41,column:2},end:{line:41,column:21}},"22":{start:{line:51,column:0},end:{line:168,column:3}},"23":{start:{line:57,column:4},end:{line:57,column:46}},"24":{start:{line:59,column:4},end:{line:59,column:51}},"25":{start:{line:68,column:2},end:{line:165,column:6}},"26":{start:{line:71,column:6},end:{line:71,column:31}},"27":{start:{line:83,column:18},end:{line:83,column:40}},"28":{start:{line:84,column:21},end:{line:84,column:40}},"29":{start:{line:85,column:25},end:{line:87,column:8}},"30":{start:{line:86,column:8},end:{line:86,column:94}},"31":{start:{line:89,column:6},end:{line:163,column:7}},"32":{start:{line:90,column:29},end:{line:90,column:55}},"33":{start:{line:91,column:22},end:{line:93,column:10}},"34":{start:{line:92,column:10},end:{line:92,column:83}},"35":{start:{line:95,column:8},end:{line:156,column:9}},"36":{start:{line:96,column:31},end:{line:96,column:49}},"37":{start:{line:97,column:34},end:{line:97,column:56}},"38":{start:{line:98,column:26},end:{line:98,column:80}},"39":{start:{line:100,column:10},end:{line:149,column:11}},"40":{start:{line:101,column:12},end:{line:105,column:14}},"41":{start:{line:107,column:32},end:{line:107,column:86}},"42":{start:{line:108,column:36},end:{line:108,column:50}},"43":{start:{line:109,column:36},end:{line:109,column:50}},"44":{start:{line:111,column:12},end:{line:121,column:13}},"45":{start:{line:112,column:14},end:{line:112,column:69}},"46":{start:{line:113,column:19},end:{line:121,column:13}},"47":{start:{line:114,column:14},end:{line:114,column:69}},"48":{start:{line:116,column:14},end:{line:120,column:16}},"49":{start:{line:123,column:39},end:{line:133,column:13}},"50":{start:{line:134,column:12},end:{line:134,column:65}},"51":{start:{line:135,column:31},end:{line:142,column:13}},"52":{start:{line:143,column:12},end:{line:148,column:14}},"53":{start:{line:151,column:10},end:{line:155,column:12}},"54":{start:{line:158,column:8},end:{line:162,column:10}},"55":{start:{line:167,column:2},end:{line:167,column:28}},"56":{start:{line:170,column:0},end:{line:170,column:40}}},fnMap:{"0":{name:"_interopRequireDefault",decl:{start:{line:16,column:9},end:{line:16,column:31}},loc:{start:{line:16,column:37},end:{line:20,column:1}},line:16},"1":{name:"_classCallCheck",decl:{start:{line:22,column:9},end:{line:22,column:24}},loc:{start:{line:22,column:48},end:{line:26,column:1}},line:22},"2":{name:"_defineProperties",decl:{start:{line:28,column:9},end:{line:28,column:26}},loc:{start:{line:28,column:42},end:{line:36,column:1}},line:28},"3":{name:"_createClass",decl:{start:{line:38,column:9},end:{line:38,column:21}},loc:{start:{line:38,column:60},end:{line:42,column:1}},line:38},"4":{name:"(anonymous_4)",decl:{start:{line:51,column:0},end:{line:51,column:1}},loc:{start:{line:51,column:12},end:{line:168,column:1}},line:51},"5":{name:"TransactionService",decl:{start:{line:56,column:11},end:{line:56,column:29}},loc:{start:{line:56,column:32},end:{line:60,column:3}},line:56},"6":{name:"getAllTransactions",decl:{start:{line:70,column:20},end:{line:70,column:38}},loc:{start:{line:70,column:41},end:{line:72,column:5}},line:70},"7":{name:"performTransaction",decl:{start:{line:82,column:20},end:{line:82,column:38}},loc:{start:{line:82,column:64},end:{line:164,column:5}},line:82},"8":{name:"(anonymous_8)",decl:{start:{line:85,column:41},end:{line:85,column:42}},loc:{start:{line:85,column:60},end:{line:87,column:7}},line:85},"9":{name:"(anonymous_9)",decl:{start:{line:91,column:61},end:{line:91,column:62}},loc:{start:{line:91,column:80},end:{line:93,column:9}},line:91}},branchMap:{"0":{loc:{start:{line:17,column:9},end:{line:19,column:3}},type:"cond-expr",locations:[{start:{line:17,column:33},end:{line:17,column:36}},{start:{line:17,column:39},end:{line:19,column:3}}],line:17},"1":{loc:{start:{line:17,column:9},end:{line:17,column:30}},type:"binary-expr",locations:[{start:{line:17,column:9},end:{line:17,column:12}},{start:{line:17,column:16},end:{line:17,column:30}}],line:17},"2":{loc:{start:{line:23,column:2},end:{line:25,column:3}},type:"if",locations:[{start:{line:23,column:2},end:{line:25,column:3}},{start:{line:23,column:2},end:{line:25,column:3}}],line:23},"3":{loc:{start:{line:31,column:28},end:{line:31,column:58}},type:"binary-expr",locations:[{start:{line:31,column:28},end:{line:31,column:49}},{start:{line:31,column:53},end:{line:31,column:58}}],line:31},"4":{loc:{start:{line:33,column:4},end:{line:33,column:58}},type:"if",locations:[{start:{line:33,column:4},end:{line:33,column:58}},{start:{line:33,column:4},end:{line:33,column:58}}],line:33},"5":{loc:{start:{line:39,column:2},end:{line:39,column:71}},type:"if",locations:[{start:{line:39,column:2},end:{line:39,column:71}},{start:{line:39,column:2},end:{line:39,column:71}}],line:39},"6":{loc:{start:{line:40,column:2},end:{line:40,column:63}},type:"if",locations:[{start:{line:40,column:2},end:{line:40,column:63}},{start:{line:40,column:2},end:{line:40,column:63}}],line:40},"7":{loc:{start:{line:86,column:15},end:{line:86,column:93}},type:"binary-expr",locations:[{start:{line:86,column:15},end:{line:86,column:36}},{start:{line:86,column:40},end:{line:86,column:64}},{start:{line:86,column:68},end:{line:86,column:93}}],line:86},"8":{loc:{start:{line:89,column:6},end:{line:163,column:7}},type:"if",locations:[{start:{line:89,column:6},end:{line:163,column:7}},{start:{line:89,column:6},end:{line:163,column:7}}],line:89},"9":{loc:{start:{line:95,column:8},end:{line:156,column:9}},type:"if",locations:[{start:{line:95,column:8},end:{line:156,column:9}},{start:{line:95,column:8},end:{line:156,column:9}}],line:95},"10":{loc:{start:{line:98,column:26},end:{line:98,column:80}},type:"cond-expr",locations:[{start:{line:98,column:68},end:{line:98,column:72}},{start:{line:98,column:75},end:{line:98,column:80}}],line:98},"11":{loc:{start:{line:100,column:10},end:{line:149,column:11}},type:"if",locations:[{start:{line:100,column:10},end:{line:149,column:11}},{start:{line:100,column:10},end:{line:149,column:11}}],line:100},"12":{loc:{start:{line:100,column:14},end:{line:100,column:80}},type:"binary-expr",locations:[{start:{line:100,column:14},end:{line:100,column:45}},{start:{line:100,column:49},end:{line:100,column:80}}],line:100},"13":{loc:{start:{line:111,column:12},end:{line:121,column:13}},type:"if",locations:[{start:{line:111,column:12},end:{line:121,column:13}},{start:{line:111,column:12},end:{line:121,column:13}}],line:111},"14":{loc:{start:{line:111,column:16},end:{line:111,column:75}},type:"binary-expr",locations:[{start:{line:111,column:16},end:{line:111,column:25}},{start:{line:111,column:29},end:{line:111,column:75}}],line:111},"15":{loc:{start:{line:113,column:19},end:{line:121,column:13}},type:"if",locations:[{start:{line:113,column:19},end:{line:121,column:13}},{start:{line:113,column:19},end:{line:121,column:13}}],line:113}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();cov_1o0dc2vijt.s[0]++;Object.defineProperty(exports,"__esModule",{value:true});cov_1o0dc2vijt.s[1]++;exports["default"]=void 0;var _transactions=(cov_1o0dc2vijt.s[2]++,require("../.data/transactions"));var _helpers=(cov_1o0dc2vijt.s[3]++,require("../Helpers/helpers"));var _user=(cov_1o0dc2vijt.s[4]++,_interopRequireDefault(require("./user.service")));var _accounts=(cov_1o0dc2vijt.s[5]++,_interopRequireDefault(require("./accounts.service")));function _interopRequireDefault(obj){cov_1o0dc2vijt.f[0]++;cov_1o0dc2vijt.s[6]++;return(cov_1o0dc2vijt.b[1][0]++,obj)&&(cov_1o0dc2vijt.b[1][1]++,obj.__esModule)?(cov_1o0dc2vijt.b[0][0]++,obj):(cov_1o0dc2vijt.b[0][1]++,{"default":obj});}function _classCallCheck(instance,Constructor){cov_1o0dc2vijt.f[1]++;cov_1o0dc2vijt.s[7]++;if(!(instance instanceof Constructor)){cov_1o0dc2vijt.b[2][0]++;cov_1o0dc2vijt.s[8]++;throw new TypeError("Cannot call a class as a function");}else{cov_1o0dc2vijt.b[2][1]++;}}function _defineProperties(target,props){cov_1o0dc2vijt.f[2]++;cov_1o0dc2vijt.s[9]++;for(var i=(cov_1o0dc2vijt.s[10]++,0);i<props.length;i++){var descriptor=(cov_1o0dc2vijt.s[11]++,props[i]);cov_1o0dc2vijt.s[12]++;descriptor.enumerable=(cov_1o0dc2vijt.b[3][0]++,descriptor.enumerable)||(cov_1o0dc2vijt.b[3][1]++,false);cov_1o0dc2vijt.s[13]++;descriptor.configurable=true;cov_1o0dc2vijt.s[14]++;if("value"in descriptor){cov_1o0dc2vijt.b[4][0]++;cov_1o0dc2vijt.s[15]++;descriptor.writable=true;}else{cov_1o0dc2vijt.b[4][1]++;}cov_1o0dc2vijt.s[16]++;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){cov_1o0dc2vijt.f[3]++;cov_1o0dc2vijt.s[17]++;if(protoProps){cov_1o0dc2vijt.b[5][0]++;cov_1o0dc2vijt.s[18]++;_defineProperties(Constructor.prototype,protoProps);}else{cov_1o0dc2vijt.b[5][1]++;}cov_1o0dc2vijt.s[19]++;if(staticProps){cov_1o0dc2vijt.b[6][0]++;cov_1o0dc2vijt.s[20]++;_defineProperties(Constructor,staticProps);}else{cov_1o0dc2vijt.b[6][1]++;}cov_1o0dc2vijt.s[21]++;return Constructor;}/**
 * @exports
 * @class TransactionService
 */var TransactionService=(/*#__PURE__*/cov_1o0dc2vijt.s[22]++,function(){cov_1o0dc2vijt.f[4]++;/**
   * Creates an instance of TransactionService.
   * @memberof TransactionService
   */function TransactionService(){cov_1o0dc2vijt.f[5]++;cov_1o0dc2vijt.s[23]++;_classCallCheck(this,TransactionService);cov_1o0dc2vijt.s[24]++;this.transactions=_transactions.transactions;}/**
   * Get all transaction resources.
   * @param null
   * @returns {object}
   */cov_1o0dc2vijt.s[25]++;_createClass(TransactionService,[{key:"getAllTransactions",value:function getAllTransactions(){cov_1o0dc2vijt.f[6]++;cov_1o0dc2vijt.s[26]++;return this.transactions;}/**
     * Performs a debit or credit account on a bank account.
     * @param {number} userId
     * @param {object} transactionInfo
     * @returns {object}
     */},{key:"performTransaction",value:function performTransaction(transactionInfo,userId){cov_1o0dc2vijt.f[7]++;var users=(cov_1o0dc2vijt.s[27]++,new _user["default"]());var allUsers=(cov_1o0dc2vijt.s[28]++,users.getAllUsers());var validCashier=(cov_1o0dc2vijt.s[29]++,allUsers.filter(function(db_user){cov_1o0dc2vijt.f[8]++;cov_1o0dc2vijt.s[30]++;return(cov_1o0dc2vijt.b[7][0]++,userId===db_user.id)&&(cov_1o0dc2vijt.b[7][1]++,db_user.type==='staff')&&(cov_1o0dc2vijt.b[7][2]++,db_user.isAdmin===false);}));cov_1o0dc2vijt.s[31]++;if(validCashier.length){cov_1o0dc2vijt.b[8][0]++;var accountService=(cov_1o0dc2vijt.s[32]++,new _accounts["default"]());var account=(cov_1o0dc2vijt.s[33]++,accountService.getAllAccounts().filter(function(account){cov_1o0dc2vijt.f[9]++;cov_1o0dc2vijt.s[34]++;return account.accountNumber===parseInt(transactionInfo.accountNumber);}));cov_1o0dc2vijt.s[35]++;if(account.length){cov_1o0dc2vijt.b[9][0]++;var accountBalance=(cov_1o0dc2vijt.s[36]++,account[0].balance);var transactionAmount=(cov_1o0dc2vijt.s[37]++,transactionInfo.amount);var debitable=(cov_1o0dc2vijt.s[38]++,accountBalance-transactionAmount>=0?(cov_1o0dc2vijt.b[10][0]++,true):(cov_1o0dc2vijt.b[10][1]++,false));cov_1o0dc2vijt.s[39]++;if((cov_1o0dc2vijt.b[12][0]++,account[0].status==='dormant')||(cov_1o0dc2vijt.b[12][1]++,account[0].status==='deleted')){cov_1o0dc2vijt.b[11][0]++;cov_1o0dc2vijt.s[40]++;return{message:"".concat(transactionInfo.type," not allowed. Account is ").concat(account.status,", kindly contact admin."),error:true,code:403};}else{cov_1o0dc2vijt.b[11][1]++;var transactionId=(cov_1o0dc2vijt.s[41]++,(0,_helpers.getLastId)(this.getAllTransactions())+1);var oldAccountBalance=(cov_1o0dc2vijt.s[42]++,accountBalance);var newAccountBalance=(cov_1o0dc2vijt.s[43]++,accountBalance);cov_1o0dc2vijt.s[44]++;if((cov_1o0dc2vijt.b[14][0]++,debitable)&&(cov_1o0dc2vijt.b[14][1]++,transactionInfo.type.toLowerCase()==='debit')){cov_1o0dc2vijt.b[13][0]++;cov_1o0dc2vijt.s[45]++;newAccountBalance=accountBalance-transactionAmount;}else{cov_1o0dc2vijt.b[13][1]++;cov_1o0dc2vijt.s[46]++;if(transactionInfo.type.toLowerCase()==='credit'){cov_1o0dc2vijt.b[15][0]++;cov_1o0dc2vijt.s[47]++;newAccountBalance=accountBalance+transactionAmount;}else{cov_1o0dc2vijt.b[15][1]++;cov_1o0dc2vijt.s[48]++;return{message:'Insufficient balance.',error:true,code:403};}}var newTransactionDetail=(cov_1o0dc2vijt.s[49]++,{id:transactionId,createdOn:new Date(),type:transactionInfo.type.toLowerCase(),accountNumber:account.accountNumber,cashier:userId,// cashier who consummated the transaction
amount:parseFloat("".concat(transactionInfo.amount,".00")),oldBalance:parseFloat("".concat(oldAccountBalance,".00")),newBalance:parseFloat("".concat(newAccountBalance,".00"))});cov_1o0dc2vijt.s[50]++;this.getAllTransactions().push(newTransactionDetail);var dataToReturn=(cov_1o0dc2vijt.s[51]++,{transactionId:transactionId,accountNumber:transactionInfo.accountNumber,amount:parseFloat("".concat(transactionInfo.amount,".00")),cashier:userId,transactionType:transactionInfo.type,accountBalance:parseFloat("".concat(newAccountBalance,".00"))});cov_1o0dc2vijt.s[52]++;return{message:"".concat(transactionInfo.type," action successfull on '").concat(account[0].accountNumber,"'"),error:false,code:200,data:dataToReturn};}}else{cov_1o0dc2vijt.b[9][1]++;cov_1o0dc2vijt.s[53]++;return{message:"Account number ".concat(transactionInfo.accountNumber," does not exist"),error:true,code:404};}}else{cov_1o0dc2vijt.b[8][1]++;cov_1o0dc2vijt.s[54]++;return{message:'You are not authorized to perform this action.',error:true,code:403};}}}]);cov_1o0dc2vijt.s[55]++;return TransactionService;}());cov_1o0dc2vijt.s[56]++;exports["default"]=TransactionService;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyYW5zYWN0aW9ucy5zZXJ2aWNlLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiX3RyYW5zYWN0aW9ucyIsInJlcXVpcmUiLCJfaGVscGVycyIsIl91c2VyIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9hY2NvdW50cyIsIm9iaiIsIl9fZXNNb2R1bGUiLCJfY2xhc3NDYWxsQ2hlY2siLCJpbnN0YW5jZSIsIkNvbnN0cnVjdG9yIiwiVHlwZUVycm9yIiwiX2RlZmluZVByb3BlcnRpZXMiLCJ0YXJnZXQiLCJwcm9wcyIsImkiLCJsZW5ndGgiLCJkZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwia2V5IiwiX2NyZWF0ZUNsYXNzIiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwicHJvdG90eXBlIiwiVHJhbnNhY3Rpb25TZXJ2aWNlIiwidHJhbnNhY3Rpb25zIiwiZ2V0QWxsVHJhbnNhY3Rpb25zIiwicGVyZm9ybVRyYW5zYWN0aW9uIiwidHJhbnNhY3Rpb25JbmZvIiwidXNlcklkIiwidXNlcnMiLCJhbGxVc2VycyIsImdldEFsbFVzZXJzIiwidmFsaWRDYXNoaWVyIiwiZmlsdGVyIiwiZGJfdXNlciIsImlkIiwidHlwZSIsImlzQWRtaW4iLCJhY2NvdW50U2VydmljZSIsImFjY291bnQiLCJnZXRBbGxBY2NvdW50cyIsImFjY291bnROdW1iZXIiLCJwYXJzZUludCIsImFjY291bnRCYWxhbmNlIiwiYmFsYW5jZSIsInRyYW5zYWN0aW9uQW1vdW50IiwiYW1vdW50IiwiZGViaXRhYmxlIiwic3RhdHVzIiwibWVzc2FnZSIsImNvbmNhdCIsImVycm9yIiwiY29kZSIsInRyYW5zYWN0aW9uSWQiLCJnZXRMYXN0SWQiLCJvbGRBY2NvdW50QmFsYW5jZSIsIm5ld0FjY291bnRCYWxhbmNlIiwidG9Mb3dlckNhc2UiLCJuZXdUcmFuc2FjdGlvbkRldGFpbCIsImNyZWF0ZWRPbiIsIkRhdGUiLCJjYXNoaWVyIiwicGFyc2VGbG9hdCIsIm9sZEJhbGFuY2UiLCJuZXdCYWxhbmNlIiwicHVzaCIsImRhdGFUb1JldHVybiIsInRyYW5zYWN0aW9uVHlwZSIsImRhdGEiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBQSxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQzNDQyxFQUFBQSxLQUFLLEVBQUU7QUFEb0MsQ0FBN0M7QUFHQUQsT0FBTyxDQUFDLFNBQUQsQ0FBUCxHQUFxQixLQUFLLENBQTFCOztBQUVBLElBQUlFLGFBQWEsR0FBR0MsT0FBTyxDQUFDLHVCQUFELENBQTNCOztBQUVBLElBQUlDLFFBQVEsR0FBR0QsT0FBTyxDQUFDLG9CQUFELENBQXRCOztBQUVBLElBQUlFLEtBQUssR0FBR0Msc0JBQXNCLENBQUNILE9BQU8sQ0FBQyxnQkFBRCxDQUFSLENBQWxDOztBQUVBLElBQUlJLFNBQVMsR0FBR0Qsc0JBQXNCLENBQUNILE9BQU8sQ0FBQyxvQkFBRCxDQUFSLENBQXRDOztBQUVBLFNBQVNHLHNCQUFULENBQWdDRSxHQUFoQyxFQUFxQztBQUFFLFNBQU9BLEdBQUcsSUFBSUEsR0FBRyxDQUFDQyxVQUFYLEdBQXdCRCxHQUF4QixHQUE4QjtBQUFFLGVBQVdBO0FBQWIsR0FBckM7QUFBMEQ7O0FBRWpHLFNBQVNFLGVBQVQsQ0FBeUJDLFFBQXpCLEVBQW1DQyxXQUFuQyxFQUFnRDtBQUFFLE1BQUksRUFBRUQsUUFBUSxZQUFZQyxXQUF0QixDQUFKLEVBQXdDO0FBQUUsVUFBTSxJQUFJQyxTQUFKLENBQWMsbUNBQWQsQ0FBTjtBQUEyRDtBQUFFOztBQUV6SixTQUFTQyxpQkFBVCxDQUEyQkMsTUFBM0IsRUFBbUNDLEtBQW5DLEVBQTBDO0FBQUUsT0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHRCxLQUFLLENBQUNFLE1BQTFCLEVBQWtDRCxDQUFDLEVBQW5DLEVBQXVDO0FBQUUsUUFBSUUs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QUFJLEVBQUUsR0FIRDtBQUlMZ0IsY0FBQUEsSUFBSSxFQUFFRjtBQUpELGFBQVA7QUFNRDtBQUNGLFNBdkRELE1BdURPO0FBQ0wsaUJBQU87QUFDTGpCLFlBQUFBLE9BQU8sRUFBRSxrQkFBa0JDLE1BQWxCLENBQXlCdkIsZUFBZSxDQUFDYyxhQUF6QyxFQUF3RCxpQkFBeEQsQ0FESjtBQUVMVSxZQUFBQSxLQUFLLEVBQUUsSUFGRjtBQUdMQyxZQUFBQSxJQUFJLEVBQUU7QUFIRCxXQUFQO0FBS0Q7QUFDRixPQXBFRCxNQW9FTztBQUNMLGVBQU87QUFDTEgsVUFBQUEsT0FBTyxFQUFFLGdEQURKO0FBRUxFLFVBQUFBLEtBQUssRUFBRSxJQUZGO0FBR0xDLFVBQUFBLElBQUksRUFBRTtBQUhELFNBQVA7QUFLRDtBQUNGO0FBcEZBLEdBWjhCLENBQXJCLENBQVo7O0FBbUdBLFNBQU83QixrQkFBUDtBQUNELENBckhELEVBRkE7O0FBeUhBNUIsT0FBTyxDQUFDLFNBQUQsQ0FBUCxHQUFxQjRCLGtCQUFyQiIsInNvdXJjZVJvb3QiOiJDOlxcVXNlcnNcXE9sYXlpbmthXFxBRENcXGJhbmthXFxhcGlcXGRpc3RcXHNlcnZpY2VzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzW1wiZGVmYXVsdFwiXSA9IHZvaWQgMDtcblxudmFyIF90cmFuc2FjdGlvbnMgPSByZXF1aXJlKFwiLi4vLmRhdGEvdHJhbnNhY3Rpb25zXCIpO1xuXG52YXIgX2hlbHBlcnMgPSByZXF1aXJlKFwiLi4vSGVscGVycy9oZWxwZXJzXCIpO1xuXG52YXIgX3VzZXIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuL3VzZXIuc2VydmljZVwiKSk7XG5cbnZhciBfYWNjb3VudHMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuL2FjY291bnRzLnNlcnZpY2VcIikpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBcImRlZmF1bHRcIjogb2JqIH07IH1cblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxuZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfVxuXG5mdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfVxuXG4vKipcbiAqIEBleHBvcnRzXG4gKiBAY2xhc3MgVHJhbnNhY3Rpb25TZXJ2aWNlXG4gKi9cbnZhciBUcmFuc2FjdGlvblNlcnZpY2UgPVxuLyojX19QVVJFX18qL1xuZnVuY3Rpb24gKCkge1xuICAvKipcbiAgICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBUcmFuc2FjdGlvblNlcnZpY2UuXG4gICAqIEBtZW1iZXJvZiBUcmFuc2FjdGlvblNlcnZpY2VcbiAgICovXG4gIGZ1bmN0aW9uIFRyYW5zYWN0aW9uU2VydmljZSgpIHtcbiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVHJhbnNhY3Rpb25TZXJ2aWNlKTtcblxuICAgIHRoaXMudHJhbnNhY3Rpb25zID0gX3RyYW5zYWN0aW9ucy50cmFuc2FjdGlvbnM7XG4gIH1cbiAgLyoqXG4gICAqIEdldCBhbGwgdHJhbnNhY3Rpb24gcmVzb3VyY2VzLlxuICAgKiBAcGFyYW0gbnVsbFxuICAgKiBAcmV0dXJucyB7b2JqZWN0fVxuICAgKi9cblxuXG4gIF9jcmVhdGVDbGFzcyhUcmFuc2FjdGlvblNlcnZpY2UsIFt7XG4gICAga2V5OiBcImdldEFsbFRyYW5zYWN0aW9uc1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRBbGxUcmFuc2FjdGlvbnMoKSB7XG4gICAgICByZXR1cm4gdGhpcy50cmFuc2FjdGlvbnM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBlcmZvcm1zIGEgZGViaXQgb3IgY3JlZGl0IGFjY291bnQgb24gYSBiYW5rIGFjY291bnQuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHVzZXJJZFxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSB0cmFuc2FjdGlvbkluZm9cbiAgICAgKiBAcmV0dXJucyB7b2JqZWN0fVxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwicGVyZm9ybVRyYW5zYWN0aW9uXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHBlcmZvcm1UcmFuc2FjdGlvbih0cmFuc2FjdGlvbkluZm8sIHVzZXJJZCkge1xuICAgICAgdmFyIHVzZXJzID0gbmV3IF91c2VyW1wiZGVmYXVsdFwiXSgpO1xuICAgICAgdmFyIGFsbFVzZXJzID0gdXNlcnMuZ2V0QWxsVXNlcnMoKTtcbiAgICAgIHZhciB2YWxpZENhc2hpZXIgPSBhbGxVc2Vycy5maWx0ZXIoZnVuY3Rpb24gKGRiX3VzZXIpIHtcbiAgICAgICAgcmV0dXJuIHVzZXJJZCA9PT0gZGJfdXNlci5pZCAmJiBkYl91c2VyLnR5cGUgPT09ICdzdGFmZicgJiYgZGJfdXNlci5pc0FkbWluID09PSBmYWxzZTtcbiAgICAgIH0pO1xuXG4gICAgICBpZiAodmFsaWRDYXNoaWVyLmxlbmd0aCkge1xuICAgICAgICB2YXIgYWNjb3VudFNlcnZpY2UgPSBuZXcgX2FjY291bnRzW1wiZGVmYXVsdFwiXSgpO1xuICAgICAgICB2YXIgYWNjb3VudCA9IGFjY291bnRTZXJ2aWNlLmdldEFsbEFjY291bnRzKCkuZmlsdGVyKGZ1bmN0aW9uIChhY2NvdW50KSB7XG4gICAgICAgICAgcmV0dXJuIGFjY291bnQuYWNjb3VudE51bWJlciA9PT0gcGFyc2VJbnQodHJhbnNhY3Rpb25JbmZvLmFjY291bnROdW1iZXIpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoYWNjb3VudC5sZW5ndGgpIHtcbiAgICAgICAgICB2YXIgYWNjb3VudEJhbGFuY2UgPSBhY2NvdW50WzBdLmJhbGFuY2U7XG4gICAgICAgICAgdmFyIHRyYW5zYWN0aW9uQW1vdW50ID0gdHJhbnNhY3Rpb25JbmZvLmFtb3VudDtcbiAgICAgICAgICB2YXIgZGViaXRhYmxlID0gYWNjb3VudEJhbGFuY2UgLSB0cmFuc2FjdGlvbkFtb3VudCA+PSAwID8gdHJ1ZSA6IGZhbHNlO1xuXG4gICAgICAgICAgaWYgKGFjY291bnRbMF0uc3RhdHVzID09PSAnZG9ybWFudCcgfHwgYWNjb3VudFswXS5zdGF0dXMgPT09ICdkZWxldGVkJykge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgbWVzc2FnZTogXCJcIi5jb25jYXQodHJhbnNhY3Rpb25JbmZvLnR5cGUsIFwiIG5vdCBhbGxvd2VkLiBBY2NvdW50IGlzIFwiKS5jb25jYXQoYWNjb3VudC5zdGF0dXMsIFwiLCBraW5kbHkgY29udGFjdCBhZG1pbi5cIiksXG4gICAgICAgICAgICAgIGVycm9yOiB0cnVlLFxuICAgICAgICAgICAgICBjb2RlOiA0MDNcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciB0cmFuc2FjdGlvbklkID0gKDAsIF9oZWxwZXJzLmdldExhc3RJZCkodGhpcy5nZXRBbGxUcmFuc2FjdGlvbnMoKSkgKyAxO1xuICAgICAgICAgICAgdmFyIG9sZEFjY291bnRCYWxhbmNlID0gYWNjb3VudEJhbGFuY2U7XG4gICAgICAgICAgICB2YXIgbmV3QWNjb3VudEJhbGFuY2UgPSBhY2NvdW50QmFsYW5jZTtcblxuICAgICAgICAgICAgaWYgKGRlYml0YWJsZSAmJiB0cmFuc2FjdGlvbkluZm8udHlwZS50b0xvd2VyQ2FzZSgpID09PSAnZGViaXQnKSB7XG4gICAgICAgICAgICAgIG5ld0FjY291bnRCYWxhbmNlID0gYWNjb3VudEJhbGFuY2UgLSB0cmFuc2FjdGlvbkFtb3VudDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHJhbnNhY3Rpb25JbmZvLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gJ2NyZWRpdCcpIHtcbiAgICAgICAgICAgICAgbmV3QWNjb3VudEJhbGFuY2UgPSBhY2NvdW50QmFsYW5jZSArIHRyYW5zYWN0aW9uQW1vdW50O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnSW5zdWZmaWNpZW50IGJhbGFuY2UuJyxcbiAgICAgICAgICAgICAgICBlcnJvcjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjb2RlOiA0MDNcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG5ld1RyYW5zYWN0aW9uRGV0YWlsID0ge1xuICAgICAgICAgICAgICBpZDogdHJhbnNhY3Rpb25JZCxcbiAgICAgICAgICAgICAgY3JlYXRlZE9uOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgICB0eXBlOiB0cmFuc2FjdGlvbkluZm8udHlwZS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgICBhY2NvdW50TnVtYmVyOiBhY2NvdW50LmFjY291bnROdW1iZXIsXG4gICAgICAgICAgICAgIGNhc2hpZXI6IHVzZXJJZCxcbiAgICAgICAgICAgICAgLy8gY2FzaGllciB3aG8gY29uc3VtbWF0ZWQgdGhlIHRyYW5zYWN0aW9uXG4gICAgICAgICAgICAgIGFtb3VudDogcGFyc2VGbG9hdChcIlwiLmNvbmNhdCh0cmFuc2FjdGlvbkluZm8uYW1vdW50LCBcIi4wMFwiKSksXG4gICAgICAgICAgICAgIG9sZEJhbGFuY2U6IHBhcnNlRmxvYXQoXCJcIi5jb25jYXQob2xkQWNjb3VudEJhbGFuY2UsIFwiLjAwXCIpKSxcbiAgICAgICAgICAgICAgbmV3QmFsYW5jZTogcGFyc2VGbG9hdChcIlwiLmNvbmNhdChuZXdBY2NvdW50QmFsYW5jZSwgXCIuMDBcIikpXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5nZXRBbGxUcmFuc2FjdGlvbnMoKS5wdXNoKG5ld1RyYW5zYWN0aW9uRGV0YWlsKTtcbiAgICAgICAgICAgIHZhciBkYXRhVG9SZXR1cm4gPSB7XG4gICAgICAgICAgICAgIHRyYW5zYWN0aW9uSWQ6IHRyYW5zYWN0aW9uSWQsXG4gICAgICAgICAgICAgIGFjY291bnROdW1iZXI6IHRyYW5zYWN0aW9uSW5mby5hY2NvdW50TnVtYmVyLFxuICAgICAgICAgICAgICBhbW91bnQ6IHBhcnNlRmxvYXQoXCJcIi5jb25jYXQodHJhbnNhY3Rpb25JbmZvLmFtb3VudCwgXCIuMDBcIikpLFxuICAgICAgICAgICAgICBjYXNoaWVyOiB1c2VySWQsXG4gICAgICAgICAgICAgIHRyYW5zYWN0aW9uVHlwZTogdHJhbnNhY3Rpb25JbmZvLnR5cGUsXG4gICAgICAgICAgICAgIGFjY291bnRCYWxhbmNlOiBwYXJzZUZsb2F0KFwiXCIuY29uY2F0KG5ld0FjY291bnRCYWxhbmNlLCBcIi4wMFwiKSlcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICBtZXNzYWdlOiBcIlwiLmNvbmNhdCh0cmFuc2FjdGlvbkluZm8udHlwZSwgXCIgYWN0aW9uIHN1Y2Nlc3NmdWxsIG9uICdcIikuY29uY2F0KGFjY291bnRbMF0uYWNjb3VudE51bWJlciwgXCInXCIpLFxuICAgICAgICAgICAgICBlcnJvcjogZmFsc2UsXG4gICAgICAgICAgICAgIGNvZGU6IDIwMCxcbiAgICAgICAgICAgICAgZGF0YTogZGF0YVRvUmV0dXJuXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbWVzc2FnZTogXCJBY2NvdW50IG51bWJlciBcIi5jb25jYXQodHJhbnNhY3Rpb25JbmZvLmFjY291bnROdW1iZXIsIFwiIGRvZXMgbm90IGV4aXN0XCIpLFxuICAgICAgICAgICAgZXJyb3I6IHRydWUsXG4gICAgICAgICAgICBjb2RlOiA0MDRcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1lc3NhZ2U6ICdZb3UgYXJlIG5vdCBhdXRob3JpemVkIHRvIHBlcmZvcm0gdGhpcyBhY3Rpb24uJyxcbiAgICAgICAgICBlcnJvcjogdHJ1ZSxcbiAgICAgICAgICBjb2RlOiA0MDNcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gVHJhbnNhY3Rpb25TZXJ2aWNlO1xufSgpO1xuXG5leHBvcnRzW1wiZGVmYXVsdFwiXSA9IFRyYW5zYWN0aW9uU2VydmljZTsiXX0=