"use strict";var cov_1cm36p8cd7=function(){var path="C:\\Users\\Olayinka\\ADC\\banka\\api\\src\\services\\transactions.service.js";var hash="4d28e4b09fd37788c0873abf6d05d4ad2dd24341";var Function=function(){}.constructor;var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Olayinka\\ADC\\banka\\api\\src\\services\\transactions.service.js",statementMap:{"0":{start:{line:3,column:0},end:{line:5,column:3}},"1":{start:{line:6,column:0},end:{line:6,column:28}},"2":{start:{line:8,column:20},end:{line:8,column:52}},"3":{start:{line:10,column:15},end:{line:10,column:44}},"4":{start:{line:12,column:12},end:{line:12,column:61}},"5":{start:{line:14,column:16},end:{line:14,column:69}},"6":{start:{line:16,column:39},end:{line:16,column:95}},"7":{start:{line:18,column:50},end:{line:18,column:151}},"8":{start:{line:18,column:92},end:{line:18,column:149}},"9":{start:{line:20,column:44},end:{line:20,column:315}},"10":{start:{line:20,column:57},end:{line:20,column:58}},"11":{start:{line:20,column:102},end:{line:20,column:110}},"12":{start:{line:20,column:112},end:{line:20,column:167}},"13":{start:{line:20,column:168},end:{line:20,column:199}},"14":{start:{line:20,column:200},end:{line:20,column:254}},"15":{start:{line:20,column:227},end:{line:20,column:254}},"16":{start:{line:20,column:255},end:{line:20,column:313}},"17":{start:{line:22,column:62},end:{line:22,column:131}},"18":{start:{line:22,column:78},end:{line:22,column:131}},"19":{start:{line:22,column:132},end:{line:22,column:193}},"20":{start:{line:22,column:149},end:{line:22,column:193}},"21":{start:{line:22,column:194},end:{line:22,column:213}},"22":{start:{line:30,column:0},end:{line:147,column:3}},"23":{start:{line:36,column:4},end:{line:36,column:46}},"24":{start:{line:38,column:4},end:{line:38,column:51}},"25":{start:{line:47,column:2},end:{line:144,column:6}},"26":{start:{line:50,column:6},end:{line:50,column:31}},"27":{start:{line:62,column:18},end:{line:62,column:40}},"28":{start:{line:63,column:21},end:{line:63,column:40}},"29":{start:{line:64,column:25},end:{line:66,column:8}},"30":{start:{line:65,column:8},end:{line:65,column:94}},"31":{start:{line:68,column:6},end:{line:142,column:7}},"32":{start:{line:69,column:29},end:{line:69,column:55}},"33":{start:{line:70,column:22},end:{line:72,column:10}},"34":{start:{line:71,column:10},end:{line:71,column:83}},"35":{start:{line:74,column:8},end:{line:135,column:9}},"36":{start:{line:75,column:31},end:{line:75,column:49}},"37":{start:{line:76,column:34},end:{line:76,column:56}},"38":{start:{line:77,column:26},end:{line:77,column:80}},"39":{start:{line:79,column:10},end:{line:128,column:11}},"40":{start:{line:80,column:12},end:{line:84,column:14}},"41":{start:{line:86,column:32},end:{line:86,column:86}},"42":{start:{line:87,column:36},end:{line:87,column:50}},"43":{start:{line:88,column:36},end:{line:88,column:50}},"44":{start:{line:90,column:12},end:{line:100,column:13}},"45":{start:{line:91,column:14},end:{line:91,column:69}},"46":{start:{line:92,column:19},end:{line:100,column:13}},"47":{start:{line:93,column:14},end:{line:93,column:69}},"48":{start:{line:95,column:14},end:{line:99,column:16}},"49":{start:{line:102,column:39},end:{line:112,column:13}},"50":{start:{line:113,column:12},end:{line:113,column:65}},"51":{start:{line:114,column:31},end:{line:121,column:13}},"52":{start:{line:122,column:12},end:{line:127,column:14}},"53":{start:{line:130,column:10},end:{line:134,column:12}},"54":{start:{line:137,column:8},end:{line:141,column:10}},"55":{start:{line:146,column:2},end:{line:146,column:28}},"56":{start:{line:149,column:0},end:{line:149,column:40}}},fnMap:{"0":{name:"_interopRequireDefault",decl:{start:{line:16,column:9},end:{line:16,column:31}},loc:{start:{line:16,column:37},end:{line:16,column:97}},line:16},"1":{name:"_classCallCheck",decl:{start:{line:18,column:9},end:{line:18,column:24}},loc:{start:{line:18,column:48},end:{line:18,column:153}},line:18},"2":{name:"_defineProperties",decl:{start:{line:20,column:9},end:{line:20,column:26}},loc:{start:{line:20,column:42},end:{line:20,column:317}},line:20},"3":{name:"_createClass",decl:{start:{line:22,column:9},end:{line:22,column:21}},loc:{start:{line:22,column:60},end:{line:22,column:215}},line:22},"4":{name:"(anonymous_4)",decl:{start:{line:30,column:0},end:{line:30,column:1}},loc:{start:{line:30,column:12},end:{line:147,column:1}},line:30},"5":{name:"TransactionService",decl:{start:{line:35,column:11},end:{line:35,column:29}},loc:{start:{line:35,column:32},end:{line:39,column:3}},line:35},"6":{name:"getAllTransactions",decl:{start:{line:49,column:20},end:{line:49,column:38}},loc:{start:{line:49,column:41},end:{line:51,column:5}},line:49},"7":{name:"performTransaction",decl:{start:{line:61,column:20},end:{line:61,column:38}},loc:{start:{line:61,column:64},end:{line:143,column:5}},line:61},"8":{name:"(anonymous_8)",decl:{start:{line:64,column:41},end:{line:64,column:42}},loc:{start:{line:64,column:60},end:{line:66,column:7}},line:64},"9":{name:"(anonymous_9)",decl:{start:{line:70,column:61},end:{line:70,column:62}},loc:{start:{line:70,column:80},end:{line:72,column:9}},line:70}},branchMap:{"0":{loc:{start:{line:16,column:46},end:{line:16,column:94}},type:"cond-expr",locations:[{start:{line:16,column:70},end:{line:16,column:73}},{start:{line:16,column:76},end:{line:16,column:94}}],line:16},"1":{loc:{start:{line:16,column:46},end:{line:16,column:67}},type:"binary-expr",locations:[{start:{line:16,column:46},end:{line:16,column:49}},{start:{line:16,column:53},end:{line:16,column:67}}],line:16},"2":{loc:{start:{line:18,column:50},end:{line:18,column:151}},type:"if",locations:[{start:{line:18,column:50},end:{line:18,column:151}},{start:{line:18,column:50},end:{line:18,column:151}}],line:18},"3":{loc:{start:{line:20,column:136},end:{line:20,column:166}},type:"binary-expr",locations:[{start:{line:20,column:136},end:{line:20,column:157}},{start:{line:20,column:161},end:{line:20,column:166}}],line:20},"4":{loc:{start:{line:20,column:200},end:{line:20,column:254}},type:"if",locations:[{start:{line:20,column:200},end:{line:20,column:254}},{start:{line:20,column:200},end:{line:20,column:254}}],line:20},"5":{loc:{start:{line:22,column:62},end:{line:22,column:131}},type:"if",locations:[{start:{line:22,column:62},end:{line:22,column:131}},{start:{line:22,column:62},end:{line:22,column:131}}],line:22},"6":{loc:{start:{line:22,column:132},end:{line:22,column:193}},type:"if",locations:[{start:{line:22,column:132},end:{line:22,column:193}},{start:{line:22,column:132},end:{line:22,column:193}}],line:22},"7":{loc:{start:{line:65,column:15},end:{line:65,column:93}},type:"binary-expr",locations:[{start:{line:65,column:15},end:{line:65,column:36}},{start:{line:65,column:40},end:{line:65,column:64}},{start:{line:65,column:68},end:{line:65,column:93}}],line:65},"8":{loc:{start:{line:68,column:6},end:{line:142,column:7}},type:"if",locations:[{start:{line:68,column:6},end:{line:142,column:7}},{start:{line:68,column:6},end:{line:142,column:7}}],line:68},"9":{loc:{start:{line:74,column:8},end:{line:135,column:9}},type:"if",locations:[{start:{line:74,column:8},end:{line:135,column:9}},{start:{line:74,column:8},end:{line:135,column:9}}],line:74},"10":{loc:{start:{line:77,column:26},end:{line:77,column:80}},type:"cond-expr",locations:[{start:{line:77,column:68},end:{line:77,column:72}},{start:{line:77,column:75},end:{line:77,column:80}}],line:77},"11":{loc:{start:{line:79,column:10},end:{line:128,column:11}},type:"if",locations:[{start:{line:79,column:10},end:{line:128,column:11}},{start:{line:79,column:10},end:{line:128,column:11}}],line:79},"12":{loc:{start:{line:79,column:14},end:{line:79,column:80}},type:"binary-expr",locations:[{start:{line:79,column:14},end:{line:79,column:45}},{start:{line:79,column:49},end:{line:79,column:80}}],line:79},"13":{loc:{start:{line:90,column:12},end:{line:100,column:13}},type:"if",locations:[{start:{line:90,column:12},end:{line:100,column:13}},{start:{line:90,column:12},end:{line:100,column:13}}],line:90},"14":{loc:{start:{line:90,column:16},end:{line:90,column:75}},type:"binary-expr",locations:[{start:{line:90,column:16},end:{line:90,column:25}},{start:{line:90,column:29},end:{line:90,column:75}}],line:90},"15":{loc:{start:{line:92,column:19},end:{line:100,column:13}},type:"if",locations:[{start:{line:92,column:19},end:{line:100,column:13}},{start:{line:92,column:19},end:{line:100,column:13}}],line:92}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();cov_1cm36p8cd7.s[0]++;Object.defineProperty(exports,"__esModule",{value:true});cov_1cm36p8cd7.s[1]++;exports["default"]=void 0;var _transactions=(cov_1cm36p8cd7.s[2]++,require("../.data/transactions"));var _helpers=(cov_1cm36p8cd7.s[3]++,require("../Helpers/helpers"));var _user=(cov_1cm36p8cd7.s[4]++,_interopRequireDefault(require("./user.service")));var _accounts=(cov_1cm36p8cd7.s[5]++,_interopRequireDefault(require("./accounts.service")));function _interopRequireDefault(obj){cov_1cm36p8cd7.f[0]++;cov_1cm36p8cd7.s[6]++;return(cov_1cm36p8cd7.b[1][0]++,obj)&&(cov_1cm36p8cd7.b[1][1]++,obj.__esModule)?(cov_1cm36p8cd7.b[0][0]++,obj):(cov_1cm36p8cd7.b[0][1]++,{"default":obj});}function _classCallCheck(instance,Constructor){cov_1cm36p8cd7.f[1]++;cov_1cm36p8cd7.s[7]++;if(!(instance instanceof Constructor)){cov_1cm36p8cd7.b[2][0]++;cov_1cm36p8cd7.s[8]++;throw new TypeError("Cannot call a class as a function");}else{cov_1cm36p8cd7.b[2][1]++;}}function _defineProperties(target,props){cov_1cm36p8cd7.f[2]++;cov_1cm36p8cd7.s[9]++;for(var i=(cov_1cm36p8cd7.s[10]++,0);i<props.length;i++){var descriptor=(cov_1cm36p8cd7.s[11]++,props[i]);cov_1cm36p8cd7.s[12]++;descriptor.enumerable=(cov_1cm36p8cd7.b[3][0]++,descriptor.enumerable)||(cov_1cm36p8cd7.b[3][1]++,false);cov_1cm36p8cd7.s[13]++;descriptor.configurable=true;cov_1cm36p8cd7.s[14]++;if("value"in descriptor){cov_1cm36p8cd7.b[4][0]++;cov_1cm36p8cd7.s[15]++;descriptor.writable=true;}else{cov_1cm36p8cd7.b[4][1]++;}cov_1cm36p8cd7.s[16]++;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){cov_1cm36p8cd7.f[3]++;cov_1cm36p8cd7.s[17]++;if(protoProps){cov_1cm36p8cd7.b[5][0]++;cov_1cm36p8cd7.s[18]++;_defineProperties(Constructor.prototype,protoProps);}else{cov_1cm36p8cd7.b[5][1]++;}cov_1cm36p8cd7.s[19]++;if(staticProps){cov_1cm36p8cd7.b[6][0]++;cov_1cm36p8cd7.s[20]++;_defineProperties(Constructor,staticProps);}else{cov_1cm36p8cd7.b[6][1]++;}cov_1cm36p8cd7.s[21]++;return Constructor;}/**
 * @exports
 * @class TransactionService
 */var TransactionService=(/*#__PURE__*/cov_1cm36p8cd7.s[22]++,function(){cov_1cm36p8cd7.f[4]++;/**
   * Creates an instance of TransactionService.
   * @memberof TransactionService
   */function TransactionService(){cov_1cm36p8cd7.f[5]++;cov_1cm36p8cd7.s[23]++;_classCallCheck(this,TransactionService);cov_1cm36p8cd7.s[24]++;this.transactions=_transactions.transactions;}/**
   * Get all transaction resources.
   * @param null
   * @returns {object}
   */cov_1cm36p8cd7.s[25]++;_createClass(TransactionService,[{key:"getAllTransactions",value:function getAllTransactions(){cov_1cm36p8cd7.f[6]++;cov_1cm36p8cd7.s[26]++;return this.transactions;}/**
     * Performs a debit or credit account on a bank account.
     * @param {number} userId
     * @param {object} transactionInfo
     * @returns {object}
     */},{key:"performTransaction",value:function performTransaction(transactionInfo,userId){cov_1cm36p8cd7.f[7]++;var users=(cov_1cm36p8cd7.s[27]++,new _user["default"]());var allUsers=(cov_1cm36p8cd7.s[28]++,users.getAllUsers());var validCashier=(cov_1cm36p8cd7.s[29]++,allUsers.filter(function(db_user){cov_1cm36p8cd7.f[8]++;cov_1cm36p8cd7.s[30]++;return(cov_1cm36p8cd7.b[7][0]++,userId===db_user.id)&&(cov_1cm36p8cd7.b[7][1]++,db_user.type==='staff')&&(cov_1cm36p8cd7.b[7][2]++,db_user.isAdmin===false);}));cov_1cm36p8cd7.s[31]++;if(validCashier.length){cov_1cm36p8cd7.b[8][0]++;var accountService=(cov_1cm36p8cd7.s[32]++,new _accounts["default"]());var account=(cov_1cm36p8cd7.s[33]++,accountService.getAllAccounts().filter(function(account){cov_1cm36p8cd7.f[9]++;cov_1cm36p8cd7.s[34]++;return account.accountNumber===parseInt(transactionInfo.accountNumber);}));cov_1cm36p8cd7.s[35]++;if(account.length){cov_1cm36p8cd7.b[9][0]++;var accountBalance=(cov_1cm36p8cd7.s[36]++,account[0].balance);var transactionAmount=(cov_1cm36p8cd7.s[37]++,transactionInfo.amount);var debitable=(cov_1cm36p8cd7.s[38]++,accountBalance-transactionAmount>=0?(cov_1cm36p8cd7.b[10][0]++,true):(cov_1cm36p8cd7.b[10][1]++,false));cov_1cm36p8cd7.s[39]++;if((cov_1cm36p8cd7.b[12][0]++,account[0].status==='dormant')||(cov_1cm36p8cd7.b[12][1]++,account[0].status==='deleted')){cov_1cm36p8cd7.b[11][0]++;cov_1cm36p8cd7.s[40]++;return{message:"".concat(transactionInfo.type," not allowed. Account is ").concat(account.status,", kindly contact admin."),error:true,code:403};}else{cov_1cm36p8cd7.b[11][1]++;var transactionId=(cov_1cm36p8cd7.s[41]++,(0,_helpers.getLastId)(this.getAllTransactions())+1);var oldAccountBalance=(cov_1cm36p8cd7.s[42]++,accountBalance);var newAccountBalance=(cov_1cm36p8cd7.s[43]++,accountBalance);cov_1cm36p8cd7.s[44]++;if((cov_1cm36p8cd7.b[14][0]++,debitable)&&(cov_1cm36p8cd7.b[14][1]++,transactionInfo.type.toLowerCase()==='debit')){cov_1cm36p8cd7.b[13][0]++;cov_1cm36p8cd7.s[45]++;newAccountBalance=accountBalance-transactionAmount;}else{cov_1cm36p8cd7.b[13][1]++;cov_1cm36p8cd7.s[46]++;if(transactionInfo.type.toLowerCase()==='credit'){cov_1cm36p8cd7.b[15][0]++;cov_1cm36p8cd7.s[47]++;newAccountBalance=accountBalance+transactionAmount;}else{cov_1cm36p8cd7.b[15][1]++;cov_1cm36p8cd7.s[48]++;return{message:'Insufficient balance.',error:true,code:403};}}var newTransactionDetail=(cov_1cm36p8cd7.s[49]++,{id:transactionId,createdOn:new Date(),type:transactionInfo.type.toLowerCase(),accountNumber:account.accountNumber,cashier:userId,// cashier who consummated the transaction
amount:parseFloat("".concat(transactionInfo.amount,".00")),oldBalance:parseFloat("".concat(oldAccountBalance,".00")),newBalance:parseFloat("".concat(newAccountBalance,".00"))});cov_1cm36p8cd7.s[50]++;this.getAllTransactions().push(newTransactionDetail);var dataToReturn=(cov_1cm36p8cd7.s[51]++,{transactionId:transactionId,accountNumber:transactionInfo.accountNumber,amount:parseFloat("".concat(transactionInfo.amount,".00")),cashier:userId,transactionType:transactionInfo.type,accountBalance:parseFloat("".concat(newAccountBalance,".00"))});cov_1cm36p8cd7.s[52]++;return{message:"".concat(transactionInfo.type," action successfull on '").concat(account[0].accountNumber,"'"),error:false,code:200,data:dataToReturn};}}else{cov_1cm36p8cd7.b[9][1]++;cov_1cm36p8cd7.s[53]++;return{message:"Account number ".concat(transactionInfo.accountNumber," does not exist"),error:true,code:404};}}else{cov_1cm36p8cd7.b[8][1]++;cov_1cm36p8cd7.s[54]++;return{message:'You are not authorized to perform this action.',error:true,code:403};}}}]);cov_1cm36p8cd7.s[55]++;return TransactionService;}());cov_1cm36p8cd7.s[56]++;exports["default"]=TransactionService;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyYW5zYWN0aW9ucy5zZXJ2aWNlLmpzIl0sIm5hbWVzIjpbIlRyYW5zYWN0aW9uU2VydmljZSIsInRyYW5zYWN0aW9ucyIsInRyYW5zYWN0aW9uSW5mbyIsInVzZXJJZCIsInVzZXJzIiwiVXNlclNlcnZpY2UiLCJhbGxVc2VycyIsImdldEFsbFVzZXJzIiwidmFsaWRDYXNoaWVyIiwiZmlsdGVyIiwiZGJfdXNlciIsImlkIiwidHlwZSIsImlzQWRtaW4iLCJsZW5ndGgiLCJhY2NvdW50U2VydmljZSIsIkFjY291bnRTZXJ2aWNlIiwiYWNjb3VudCIsImdldEFsbEFjY291bnRzIiwiYWNjb3VudE51bWJlciIsInBhcnNlSW50IiwiYWNjb3VudEJhbGFuY2UiLCJiYWxhbmNlIiwidHJhbnNhY3Rpb25BbW91bnQiLCJhbW91bnQiLCJkZWJpdGFibGUiLCJzdGF0dXMiLCJtZXNzYWdlIiwiZXJyb3IiLCJjb2RlIiwidHJhbnNhY3Rpb25JZCIsImdldEFsbFRyYW5zYWN0aW9ucyIsIm9sZEFjY291bnRCYWxhbmNlIiwibmV3QWNjb3VudEJhbGFuY2UiLCJ0b0xvd2VyQ2FzZSIsIm5ld1RyYW5zYWN0aW9uRGV0YWlsIiwiY3JlYXRlZE9uIiwiRGF0ZSIsImNhc2hpZXIiLCJwYXJzZUZsb2F0Iiwib2xkQmFsYW5jZSIsIm5ld0JhbGFuY2UiLCJwdXNoIiwiZGF0YVRvUmV0dXJuIiwidHJhbnNhY3Rpb25UeXBlIiwiZGF0YSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7Ozs7O0FBRUE7Ozs7SUFLcUJBLGtCOzs7QUFDbkI7Ozs7QUFJQSxnQ0FBYztBQUFBOztBQUNaLFNBQUtDLFlBQUwsR0FBb0JBLDBCQUFwQjtBQUNEO0FBRUQ7Ozs7Ozs7Ozt5Q0FLcUI7QUFDbkIsYUFBTyxLQUFLQSxZQUFaO0FBQ0Q7QUFFRDs7Ozs7Ozs7O3VDQU1tQkMsZSxFQUFpQkMsTSxFQUFRO0FBQzFDLFVBQU1DLEtBQUssR0FBRyxJQUFJQyxn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SU4saUJBQUo7QUFSSyxhQUE3QjtBQVVBLGlCQUFLRixrQkFBTCxHQUEwQlcsSUFBMUIsQ0FBK0JQLG9CQUEvQjtBQUNBLGdCQUFNUSxZQUFZLEdBQUc7QUFDbkJiLGNBQUFBLGFBQWEsRUFBYkEsYUFEbUI7QUFFbkJYLGNBQUFBLGFBQWEsRUFBRWpCLGVBQWUsQ0FBQ2lCLGFBRlo7QUFHbkJLLGNBQUFBLE1BQU0sRUFBRWUsVUFBVSxXQUFJckMsZUFBZSxDQUFDc0IsTUFBcEIsU0FIQztBQUluQmMsY0FBQUEsT0FBTyxFQUFFbkMsTUFKVTtBQUtuQnlDLGNBQUFBLGVBQWUsRUFBRTFDLGVBQWUsQ0FBQ1UsSUFMZDtBQU1uQlMsY0FBQUEsY0FBYyxFQUFFa0IsVUFBVSxXQUFJTixpQkFBSjtBQU5QLGFBQXJCO0FBUUEsbUJBQU87QUFDTE4sY0FBQUEsT0FBTyxZQUFLekIsZUFBZSxDQUFDVSxJQUFyQixxQ0FBb0RLLE9BQU8sQ0FBQyxDQUFELENBQVAsQ0FBV0UsYUFBL0QsTUFERjtBQUVMUyxjQUFBQSxLQUFLLEVBQUUsS0FGRjtBQUdMQyxjQUFBQSxJQUFJLEVBQUUsR0FIRDtBQUlMZ0IsY0FBQUEsSUFBSSxFQUFFRjtBQUpELGFBQVA7QUFNRDtBQUNGLFNBdERELE1Bc0RPO0FBQ0wsaUJBQU87QUFDTGhCLFlBQUFBLE9BQU8sMkJBQW9CekIsZUFBZSxDQUFDaUIsYUFBcEMsb0JBREY7QUFFTFMsWUFBQUEsS0FBSyxFQUFFLElBRkY7QUFHTEMsWUFBQUEsSUFBSSxFQUFFO0FBSEQsV0FBUDtBQUtEO0FBQ0YsT0FsRUQsTUFrRU87QUFDTCxlQUFPO0FBQ0xGLFVBQUFBLE9BQU8sRUFBRSxnREFESjtBQUVMQyxVQUFBQSxLQUFLLEVBQUUsSUFGRjtBQUdMQyxVQUFBQSxJQUFJLEVBQUU7QUFIRCxTQUFQO0FBS0Q7QUFDRiIsInNvdXJjZVJvb3QiOiJDOlxcVXNlcnNcXE9sYXlpbmthXFxBRENcXGJhbmthXFxhcGlcXHNyY1xcc2VydmljZXMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB0cmFuc2FjdGlvbnMgfSBmcm9tICcuLi8uZGF0YS90cmFuc2FjdGlvbnMnO1xuaW1wb3J0IHsgcmVjb3JkRXhpc3RzLCBnZXRMYXN0SWQgfSBmcm9tICcuLi9IZWxwZXJzL2hlbHBlcnMnO1xuaW1wb3J0IFVzZXJTZXJ2aWNlIGZyb20gJy4vdXNlci5zZXJ2aWNlJztcbmltcG9ydCBBY2NvdW50U2VydmljZSBmcm9tICcuL2FjY291bnRzLnNlcnZpY2UnO1xuXG4vKipcbiAqIEBleHBvcnRzXG4gKiBAY2xhc3MgVHJhbnNhY3Rpb25TZXJ2aWNlXG4gKi9cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVHJhbnNhY3Rpb25TZXJ2aWNlIHtcbiAgLyoqXG4gICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgVHJhbnNhY3Rpb25TZXJ2aWNlLlxuICAgKiBAbWVtYmVyb2YgVHJhbnNhY3Rpb25TZXJ2aWNlXG4gICAqL1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnRyYW5zYWN0aW9ucyA9IHRyYW5zYWN0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWxsIHRyYW5zYWN0aW9uIHJlc291cmNlcy5cbiAgICogQHBhcmFtIG51bGxcbiAgICogQHJldHVybnMge29iamVjdH1cbiAgICovXG4gIGdldEFsbFRyYW5zYWN0aW9ucygpIHtcbiAgICByZXR1cm4gdGhpcy50cmFuc2FjdGlvbnM7XG4gIH1cblxuICAvKipcbiAgICogUGVyZm9ybXMgYSBkZWJpdCBvciBjcmVkaXQgYWNjb3VudCBvbiBhIGJhbmsgYWNjb3VudC5cbiAgICogQHBhcmFtIHtudW1iZXJ9IHVzZXJJZFxuICAgKiBAcGFyYW0ge29iamVjdH0gdHJhbnNhY3Rpb25JbmZvXG4gICAqIEByZXR1cm5zIHtvYmplY3R9XG4gICAqL1xuICBwZXJmb3JtVHJhbnNhY3Rpb24odHJhbnNhY3Rpb25JbmZvLCB1c2VySWQpIHtcbiAgICBjb25zdCB1c2VycyA9IG5ldyBVc2VyU2VydmljZSgpO1xuICAgIGNvbnN0IGFsbFVzZXJzID0gdXNlcnMuZ2V0QWxsVXNlcnMoKTtcbiAgICBjb25zdCB2YWxpZENhc2hpZXIgPSBhbGxVc2Vycy5maWx0ZXIoZGJfdXNlciA9PiB7XG4gICAgICByZXR1cm4gdXNlcklkID09PSBkYl91c2VyLmlkICYmIGRiX3VzZXIudHlwZSA9PT0gJ3N0YWZmJyAmJiBkYl91c2VyLmlzQWRtaW4gPT09IGZhbHNlO1xuICAgIH0pO1xuICAgIGlmICh2YWxpZENhc2hpZXIubGVuZ3RoKSB7XG4gICAgICBjb25zdCBhY2NvdW50U2VydmljZSA9IG5ldyBBY2NvdW50U2VydmljZSgpO1xuICAgICAgY29uc3QgYWNjb3VudCA9IGFjY291bnRTZXJ2aWNlLmdldEFsbEFjY291bnRzKCkuZmlsdGVyKGFjY291bnQgPT4ge1xuICAgICAgICByZXR1cm4gYWNjb3VudC5hY2NvdW50TnVtYmVyID09PSBwYXJzZUludCh0cmFuc2FjdGlvbkluZm8uYWNjb3VudE51bWJlcik7XG4gICAgICB9KTtcbiAgICAgIGlmIChhY2NvdW50Lmxlbmd0aCkge1xuICAgICAgICBjb25zdCBhY2NvdW50QmFsYW5jZSA9IGFjY291bnRbMF0uYmFsYW5jZTtcbiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb25BbW91bnQgPSB0cmFuc2FjdGlvbkluZm8uYW1vdW50O1xuICAgICAgICBjb25zdCBkZWJpdGFibGUgPSBhY2NvdW50QmFsYW5jZSAtIHRyYW5zYWN0aW9uQW1vdW50ID49IDAgPyB0cnVlIDogZmFsc2U7XG5cbiAgICAgICAgaWYgKGFjY291bnRbMF0uc3RhdHVzID09PSAnZG9ybWFudCcgfHwgYWNjb3VudFswXS5zdGF0dXMgPT09ICdkZWxldGVkJykge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBtZXNzYWdlOiBgJHt0cmFuc2FjdGlvbkluZm8udHlwZX0gbm90IGFsbG93ZWQuIEFjY291bnQgaXMgJHtcbiAgICAgICAgICAgICAgYWNjb3VudC5zdGF0dXNcbiAgICAgICAgICAgIH0sIGtpbmRseSBjb250YWN0IGFkbWluLmAsXG4gICAgICAgICAgICBlcnJvcjogdHJ1ZSxcbiAgICAgICAgICAgIGNvZGU6IDQwM1xuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgdHJhbnNhY3Rpb25JZCA9IGdldExhc3RJZCh0aGlzLmdldEFsbFRyYW5zYWN0aW9ucygpKSArIDE7XG4gICAgICAgICAgY29uc3Qgb2xkQWNjb3VudEJhbGFuY2UgPSBhY2NvdW50QmFsYW5jZTtcbiAgICAgICAgICBsZXQgbmV3QWNjb3VudEJhbGFuY2UgPSBhY2NvdW50QmFsYW5jZTtcbiAgICAgICAgICBpZiAoZGViaXRhYmxlICYmIHRyYW5zYWN0aW9uSW5mby50eXBlLnRvTG93ZXJDYXNlKCkgPT09ICdkZWJpdCcpIHtcbiAgICAgICAgICAgIG5ld0FjY291bnRCYWxhbmNlID0gYWNjb3VudEJhbGFuY2UgLSB0cmFuc2FjdGlvbkFtb3VudDtcbiAgICAgICAgICB9IGVsc2UgaWYgKHRyYW5zYWN0aW9uSW5mby50eXBlLnRvTG93ZXJDYXNlKCkgPT09ICdjcmVkaXQnKSB7XG4gICAgICAgICAgICBuZXdBY2NvdW50QmFsYW5jZSA9IGFjY291bnRCYWxhbmNlICsgdHJhbnNhY3Rpb25BbW91bnQ7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIG1lc3NhZ2U6ICdJbnN1ZmZpY2llbnQgYmFsYW5jZS4nLFxuICAgICAgICAgICAgICBlcnJvcjogdHJ1ZSxcbiAgICAgICAgICAgICAgY29kZTogNDAzXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBuZXdUcmFuc2FjdGlvbkRldGFpbCA9IHtcbiAgICAgICAgICAgIGlkOiB0cmFuc2FjdGlvbklkLFxuICAgICAgICAgICAgY3JlYXRlZE9uOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgdHlwZTogdHJhbnNhY3Rpb25JbmZvLnR5cGUudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIGFjY291bnROdW1iZXI6IGFjY291bnQuYWNjb3VudE51bWJlcixcbiAgICAgICAgICAgIGNhc2hpZXI6IHVzZXJJZCwgLy8gY2FzaGllciB3aG8gY29uc3VtbWF0ZWQgdGhlIHRyYW5zYWN0aW9uXG4gICAgICAgICAgICBhbW91bnQ6IHBhcnNlRmxvYXQoYCR7dHJhbnNhY3Rpb25JbmZvLmFtb3VudH0uMDBgKSxcbiAgICAgICAgICAgIG9sZEJhbGFuY2U6IHBhcnNlRmxvYXQoYCR7b2xkQWNjb3VudEJhbGFuY2V9LjAwYCksXG4gICAgICAgICAgICBuZXdCYWxhbmNlOiBwYXJzZUZsb2F0KGAke25ld0FjY291bnRCYWxhbmNlfS4wMGApXG4gICAgICAgICAgfTtcbiAgICAgICAgICB0aGlzLmdldEFsbFRyYW5zYWN0aW9ucygpLnB1c2gobmV3VHJhbnNhY3Rpb25EZXRhaWwpO1xuICAgICAgICAgIGNvbnN0IGRhdGFUb1JldHVybiA9IHtcbiAgICAgICAgICAgIHRyYW5zYWN0aW9uSWQsXG4gICAgICAgICAgICBhY2NvdW50TnVtYmVyOiB0cmFuc2FjdGlvbkluZm8uYWNjb3VudE51bWJlcixcbiAgICAgICAgICAgIGFtb3VudDogcGFyc2VGbG9hdChgJHt0cmFuc2FjdGlvbkluZm8uYW1vdW50fS4wMGApLFxuICAgICAgICAgICAgY2FzaGllcjogdXNlcklkLFxuICAgICAgICAgICAgdHJhbnNhY3Rpb25UeXBlOiB0cmFuc2FjdGlvbkluZm8udHlwZSxcbiAgICAgICAgICAgIGFjY291bnRCYWxhbmNlOiBwYXJzZUZsb2F0KGAke25ld0FjY291bnRCYWxhbmNlfS4wMGApXG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbWVzc2FnZTogYCR7dHJhbnNhY3Rpb25JbmZvLnR5cGV9IGFjdGlvbiBzdWNjZXNzZnVsbCBvbiAnJHthY2NvdW50WzBdLmFjY291bnROdW1iZXJ9J2AsXG4gICAgICAgICAgICBlcnJvcjogZmFsc2UsXG4gICAgICAgICAgICBjb2RlOiAyMDAsXG4gICAgICAgICAgICBkYXRhOiBkYXRhVG9SZXR1cm5cbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1lc3NhZ2U6IGBBY2NvdW50IG51bWJlciAke3RyYW5zYWN0aW9uSW5mby5hY2NvdW50TnVtYmVyfSBkb2VzIG5vdCBleGlzdGAsXG4gICAgICAgICAgZXJyb3I6IHRydWUsXG4gICAgICAgICAgY29kZTogNDA0XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1lc3NhZ2U6ICdZb3UgYXJlIG5vdCBhdXRob3JpemVkIHRvIHBlcmZvcm0gdGhpcyBhY3Rpb24uJyxcbiAgICAgICAgZXJyb3I6IHRydWUsXG4gICAgICAgIGNvZGU6IDQwM1xuICAgICAgfTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==